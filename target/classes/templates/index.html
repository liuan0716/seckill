<!DOCTYPE HTML>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org" xmlns:fmt="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <!-- Bootstrap -->
    <link th:href="@{/css/signin.css}" rel="stylesheet">
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/me.css}" rel="stylesheet">
    <title>主页</title>
</head>
<body>

    <div class="headBar" th:include="header ::pagination"></div>
    <br/><br/><br/>
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>seckilledId</th>
                    <th>objName</th>
                    <th>number</th>
                    <th>createTime</th>
                    <th>startTime</th>
                    <th>endTime</th>
                    <th>more</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="obj:${list}">
                    <td th:text="${obj.seckilledId}"></td>
                    <td th:text="${obj.objName}"></td>
                    <td th:text="${obj.number}"></td>
                    <td th:text="${#dates.format(obj.createTime,'yyyy-MM-dd HH:mm:ss')}"></td>
                    <td th:text="${#dates.format(obj.startTime,'yyyy-MM-dd HH:mm:ss')}"></td>
                    <td th:text="${#dates.format(obj.endTime,'yyyy-MM-dd HH:mm:ss')}"></td>
                    <td>
                        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" th:onclick="'goToDetail('+${obj.seckilledId}+')'">
                            detail
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script th:src="@{/js/jquery-3.4.1.min.js}"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script th:src="@{/js/bootstrap.min.js}"></script>

    <script th:inline="javascript">

        function getCookie(cname) {
            const name = cname + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const ca = decodedCookie.split(';');
            for(let i = 0; i <ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
        //起始脚本，监测到session，隐藏登陆表单，显示登陆名
        $(function(){
            const username=getCookie("username");
            const phone=getCookie("phone");
            if(username!=""){
                $("#form1").addClass("hidden");

                $("#username_place").removeClass("hidden");
                $("#username_place").html(username);
            }

        });
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const ctxPath =/*[[${#httpServletRequest.getScheme() + '://' + #httpServletRequest.getServerName() + ':' + #request.getServerPort()  + #request.getContextPath() + '/'}]]*/
            /*]]>*/
        function goToDetail(id){
            window.location.href=ctxPath+"seckill/"+id+"/detail";
        }
    </script>

    <script th:inline="javascript">
        function form_submit(){

            const user = {
                "email": $("#inputEmail").val(),
                "password": $("#inputPassword").val()
            };
            $.ajax(
                {
                    url:ctxPath+"user/login/execution",
                    type:"post",
                    dataType:"json",
                    data:user,
                    success:function(data){
                        if(data.status==-1){
                            //密码错误
                            $("#checkPassword").addClass("has-error has-feedback");
                        }else if(data.status==-2){
                            //用户不存在
                            alert("用户不存在");
                            $("#checkEmail").addClass("has-error has-feedback");
                            window.location.href=ctxPath+"user/reg";
                        }else if(data.status==1){
                            window.location.href=ctxPath+"seckill/list";
                        }

                    },
                    error:function(){
                        window.location.href=ctxPath+"user/login";
                    }
                }
            );

        }
    </script>


</body>
</html>